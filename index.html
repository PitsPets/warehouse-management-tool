<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Warehouse Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <!-- PDF & Charting Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Firebase Configuration & Initialization ---
        const firebaseConfig = {
            apiKey: "AIzaSyC9Tf7tOlZhYNe6ubDZ7JFJhsMswiimxPw",
            authDomain: "dlv-warehouse-tracker.firebaseapp.com",
            projectId: "dlv-warehouse-tracker",
            storageBucket: "dlv-warehouse-tracker.appspot.com",
            messagingSenderId: "267729758583",
            appId: "1:267729758583:web:f5f7ca26afc99c17819972",
            measurementId: "G-1DH9GT5RXS"
        };
        const appId = 'dlv-warehouse-tracker';
        
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        function App() {
            // Helper Components must be defined inside the App component or globally before App
            const Modal = ({ children, onClose, size = 'md' }) => {
                const sizeClasses = { sm: 'max-w-sm', md: 'max-w-md', lg: 'max-w-lg', xl: 'max-w-xl', '3xl': 'max-w-3xl', '5xl': 'max-w-5xl', '7xl': 'max-w-7xl' };
                return (<div className="fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 transition-opacity duration-300"><div className={`bg-white rounded-2xl shadow-2xl w-full ${sizeClasses[size]} p-6 relative transform transition-all duration-300 scale-95 opacity-0 animate-scale-in`}><button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors z-10" aria-label="Close modal"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>{children}</div></div>);
            };
            const Spinner = ({ text = "Loading..." }) => <div className="bg-gray-100 min-h-screen flex flex-col justify-center items-center p-4"><div className="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div><p className="mt-4 text-gray-500">{text}</p></div>;
            const ConfirmationModal = ({ isOpen, onClose, onConfirm, message }) => !isOpen ? null : <Modal onClose={onClose}><div className="text-center"><h3 className="text-lg font-medium text-gray-900 mb-4">{message}</h3><div className="flex justify-center gap-4"><button onClick={onClose} className="px-6 py-2 text-gray-700 bg-gray-100 rounded-full hover:bg-gray-200">Cancel</button><button onClick={onConfirm} className="px-6 py-2 text-white bg-red-600 rounded-full hover:bg-red-700">Confirm</button></div></div></Modal>;
            const ChartComponent = ({ type, data, options }) => { /* ... definition ... */ };
            const StatsWidget = ({ inventory }) => { /* ... definition ... */ };
            const AllInventoryWidget = ({ inventory, onEdit, onDelete, onAdjustStock, isLoading, searchTerm, setSearchTerm, isAdminMode, settings }) => { /* ... definition ... */ };
            const LogsWidget = ({ isLoading }) => { /* ... definition ... */ };
            const AdminLoginModal = ({ onLogin }) => { /* ... definition ... */ };
            const ItemForm = ({ currentItem, onSave, onClose }) => { /* ... definition ... */ };
            const SiteManagementForm = ({ sites, onClose }) => { /* ... definition ... */ };
            const AdjustStockForm = ({ item, onAdjust, onClose }) => { /* ... definition ... */ };
            const SettingsForm = ({ currentSettings, onClose }) => { /* ... definition ... */ };
            const DeliveryReceiptForm = ({ allItems, sites, onComplete, currentUser }) => { /* ... definition ... */ };
            const DRDisplay = ({ receiptData, onDone }) => { /* ... definition ... */ };
            const DRHistory = () => { /* ... definition ... */ };

            const [user, setUser] = useState(null);
            const [isAdminMode, setIsAdminMode] = useState(false);
            const [inventory, setInventory] = useState([]);
            const [sites, setSites] = useState([]);
            const [receipts, setReceipts] = useState([]);
            const [settings, setSettings] = useState({ adminPass: 'superadmin' });
            const [isLoading, setIsLoading] = useState(true);
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [modal, setModal] = useState(null);
            const [currentItem, setCurrentItem] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [itemToDelete, setItemToDelete] = useState(null);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (authUser) => {
                    if (authUser) {
                        setUser(authUser);
                    } else {
                        try {
                            await auth.signInAnonymously();
                        } catch (e) {
                            console.error("Anonymous sign-in failed", e);
                        }
                    }
                    setIsAuthReady(true);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!isAuthReady) return;
                
                const basePath = `artifacts/${appId}/public/data`;
                
                const unsubInv = db.collection(`${basePath}/inventory`).orderBy('name').onSnapshot(snap => setInventory(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubSites = db.collection(`${basePath}/sites`).orderBy('name').onSnapshot(snap => setSites(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubSettings = db.doc(`${basePath}/settings/general`).onSnapshot((d) => { if (d.exists) { setSettings(s => ({...s, ...d.data()})); } });
                const unsubReceipts = db.collection(`${basePath}/deliveryReceipts`).orderBy('createdAt', 'desc').onSnapshot(snap => setReceipts(snap.docs.map(d => ({id:d.id, ...d.data()}))));
                
                setIsLoading(false);
                return () => { unsubInv(); unsubSites(); unsubSettings(); unsubReceipts(); };
            }, [isAuthReady]);

            // ... All handler functions ...

            if (!isAuthReady || !user) return <Spinner />;

            return (
                <div className="bg-gray-100 min-h-screen font-sans">
                     <style>{`@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap'); body { font-family: 'Poppins', sans-serif; } @keyframes scale-in{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-scale-in{animation:scale-in .2s ease-out forwards}@media print{body *{visibility:hidden}.printable-area,.printable-area *{visibility:visible}.printable-area{position:absolute;left:0;top:0;width:100%}.no-print{display:none}}`}</style>
                    <div className="container mx-auto p-4 sm:p-6 lg:p-8">
                        <header className="flex flex-wrap justify-between items-center gap-4 mb-8">
                            <div><h1 className="text-4xl font-bold text-gray-800">Warehouse Management</h1><p className="text-gray-500 mt-1">Logged in as: <span className={isAdminMode ? "font-bold text-indigo-600" : ""}>{isAdminMode ? "Administrator" : "User"}</span></p></div>
                            <div className="flex gap-2">
                                {/* Buttons */}
                            </div>
                        </header>
                         {/* Widgets */}
                    </div>
                     {/* Modals */}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));

    </script>
</body>
</html>
