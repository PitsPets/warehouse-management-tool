<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Warehouse Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase Compatibility Libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- PDF & Charting Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Firebase Configuration & Initialization ---
        const firebaseConfig = {
            apiKey: "AIzaSyC9Tf7tOlZhYNe6ubDZ7JFJhsMswiimxPw",
            authDomain: "dlv-warehouse-tracker.firebaseapp.com",
            projectId: "dlv-warehouse-tracker",
            storageBucket: "dlv-warehouse-tracker.appspot.com",
            messagingSenderId: "267729758583",
            appId: "1:267729758583:web:f5f7ca26afc99c17819972",
            measurementId: "G-1DH9GT5RXS"
        };
        const appId = 'dlv-warehouse-tracker';
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- All Components and App Logic are defined here ---

        const formatCurrency = (value) => new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP' }).format(value || 0);

        const Modal = ({ children, onClose, size = 'md' }) => {
            const sizeClasses = { sm: 'max-w-sm', md: 'max-w-md', lg: 'max-w-lg', xl: 'max-w-xl', '3xl': 'max-w-3xl', '5xl': 'max-w-5xl', '7xl': 'max-w-7xl' };
            return (<div className="fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 transition-opacity duration-300 animate-scale-in"><div className={`bg-white rounded-2xl shadow-2xl w-full ${sizeClasses[size]} p-6 relative transform transition-all duration-300`}><button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors z-10" aria-label="Close modal"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>{children}</div></div>);
        };

        const Spinner = ({ text = "Loading..." }) => <div className="bg-gray-100 min-h-screen flex flex-col justify-center items-center p-4"><div className="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div><p className="mt-4 text-gray-500">{text}</p></div>;

        const ConfirmationModal = ({ isOpen, onClose, onConfirm, message }) => !isOpen ? null : <Modal onClose={onClose}><div className="text-center"><h3 className="text-lg font-medium text-gray-900 mb-4">{message}</h3><div className="flex justify-center gap-4"><button onClick={onClose} className="px-6 py-2 text-gray-700 bg-gray-100 rounded-full hover:bg-gray-200">Cancel</button><button onClick={onConfirm} className="px-6 py-2 text-white bg-red-600 rounded-full hover:bg-red-700">Confirm</button></div></div></Modal>;

        const logAction = async (userName, action, details) => {
            try { await db.collection(`artifacts/${appId}/public/data/logs`).add({ timestamp: firebase.firestore.FieldValue.serverTimestamp(), action, details, user: userName }); } 
            catch (error) { console.error("Failed to log action:", error); }
        };
        
        const ChartComponent = ({ type, data, options }) => {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            useEffect(() => {
                if (!chartRef.current || !window.Chart) return;
                if (chartInstance.current) chartInstance.current.destroy();
                chartInstance.current = new window.Chart(chartRef.current, { type, data, options });
                return () => { if (chartInstance.current) chartInstance.current.destroy(); };
            }, [data, type, options]);
            return <canvas ref={chartRef}></canvas>;
        };

        const StatsWidget = ({ inventory }) => {
            const totalItems = inventory.length;
            const totalQuantity = inventory.reduce((sum, item) => sum + Number(item.qty || 0), 0);
            const totalValue = inventory.reduce((sum, item) => sum + (Number(item.qty || 0) * Number(item.price || 0)), 0);
            const stats = [{ name: 'Total Unique Items', value: totalItems, icon: 'üì¶' }, { name: 'Total Quantity', value: totalQuantity, icon: 'üî¢' }, { name: 'Total Inventory Value', value: formatCurrency(totalValue), icon: 'üí∞' }];
            return (<div className="bg-white rounded-2xl shadow-lg p-6"><h3 className="text-lg font-bold text-gray-800 mb-4">At a Glance</h3><div className="grid grid-cols-1 sm:grid-cols-3 gap-4">{stats.map(stat => (<div key={stat.name} className="bg-gray-50 rounded-lg p-4 flex items-center gap-4"><div><p className="text-sm text-gray-500">{stat.name}</p><p className="text-2xl font-bold text-gray-800">{stat.value}</p></div></div>))}</div></div>);
        };

        const AllInventoryWidget = ({ inventory, onEdit, onDelete, onAdjustStock, isLoading, searchTerm, setSearchTerm, isAdminMode, settings }) => (
             <div className="bg-white rounded-2xl shadow-lg p-6 lg:col-span-2">
                <div className="flex flex-wrap gap-4 justify-between items-center mb-4">
                    <h3 className="text-lg font-bold text-gray-800">Global Inventory</h3>
                    <div className="relative w-full sm:w-64">
                        <input type="text" placeholder="Search by SKU, name..." className="w-full pl-9 pr-4 py-1.5 border border-gray-200 rounded-full text-sm" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                        <svg className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                </div>
                {isLoading ? <Spinner /> : (
                    <div className="overflow-x-auto -mx-6">
                        <table className="w-full text-left table-auto">
                            <thead><tr className="border-b-2 border-gray-100"><th className="p-4 text-sm font-semibold text-gray-600">SKU</th><th className="p-4 text-sm font-semibold text-gray-600">Name</th><th className="p-4 text-sm font-semibold text-gray-600">Price</th><th className="p-4 text-sm font-semibold text-gray-600">Qty</th><th className="p-4 text-sm font-semibold text-gray-600 text-right">Actions</th></tr></thead>
                            <tbody>
                                {inventory.length > 0 ? inventory.map(item => (
                                    <tr key={item.id} className="border-b border-gray-100 hover:bg-gray-50">
                                        <td className="p-4 font-mono text-xs text-gray-500">{item.sku}</td>
                                        <td className="p-4"><p className="font-medium text-gray-800">{item.name}</p><p className="text-sm text-gray-500">{item.brand}</p></td>
                                        <td className="p-4 text-gray-600">{formatCurrency(item.price)}</td>
                                        <td className={`p-4 font-semibold ${Number(item.qty) < Number(item.reorderLevel || settings.reorderLevel) ? 'text-red-500' : 'text-gray-600'}`}>{item.qty}</td>
                                        <td className="p-4 text-right"><div className="flex justify-end gap-1">{ isAdminMode && <>
                                            <button onClick={() => onAdjustStock(item)} className="p-2 text-gray-400 hover:text-green-600 rounded-full hover:bg-gray-100" title="Adjust Stock">¬±</button>
                                            <button onClick={() => onEdit(item)} className="p-2 text-gray-400 hover:text-indigo-600 rounded-full hover:bg-gray-100" title="Edit Item">‚úèÔ∏è</button>
                                            <button onClick={() => onDelete(item.id)} className="p-2 text-gray-400 hover:text-red-600 rounded-full hover:bg-gray-100" title="Delete Item">üóëÔ∏è</button>
                                        </>}</div></td>
                                    </tr>
                                )) : (<tr><td colSpan="5" className="text-center p-8 text-gray-500">{searchTerm ? `No items found.` : `Inventory is empty.`}</td></tr>)}
                            </tbody>
                        </table>
                    </div>
                )}
            </div>
        );
        const LogsWidget = ({ isLoading }) => {
            const [logs, setLogs] = useState([]);
            useEffect(() => {
                const q = db.collection(`artifacts/${appId}/public/data/logs`).orderBy('timestamp', 'desc').limit(20);
                const unsub = q.onSnapshot(snapshot => setLogs(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))));
                return () => unsub();
            }, []);
            return (<div className="bg-white rounded-2xl shadow-lg p-6"><h3 className="text-lg font-bold text-gray-800 mb-4">Activity Logs</h3>{isLoading ? <Spinner/> : logs.length > 0 ? (<ul className="space-y-3">{logs.map(log => (<li key={log.id} className="text-sm"><p className="font-medium text-gray-700">{log.action} by <span className="text-indigo-600">{log.user || 'System'}</span>: <span className="font-normal text-gray-600">{log.details}</span></p><p className="text-xs text-gray-400">{log.timestamp?.toDate().toLocaleString()}</p></li>))}</ul>) : <p className="text-center py-8 text-gray-500">No recent activity.</p>}</div>);
        };
        const AdminLoginModal = ({ onLogin }) => {
            const [password, setPassword] = useState('');
            const handleSubmit = (e) => { e.preventDefault(); onLogin(password); };
            return (<form onSubmit={handleSubmit} className="space-y-4"><h2 className="text-2xl font-bold text-center text-gray-800">Admin Access</h2><div><label className="block text-sm font-medium">Password</label><input type="password" value={password} onChange={e => setPassword(e.target.value)} className="w-full px-3 py-2 border rounded-lg" autoFocus/></div><button type="submit" className="w-full px-6 py-2 text-white bg-indigo-600 rounded-full">Unlock</button></form>);
        };
        const ItemForm = ({ currentItem, onSave, onClose }) => {
            const [item, setItem] = useState({ name: '', brand: '', qty: '0', location: '', sku: '', price: '0.00', reorderLevel: '10' });
            useEffect(() => { currentItem ? setItem(currentItem) : setItem({ name: '', brand: '', qty: '0', location: '', sku: `SKU-${Date.now()}`, price: '0.00', reorderLevel: '10' }); }, [currentItem]);
            const handleChange = (e) => setItem(prev => ({ ...prev, [e.target.name]: e.target.value }));
            const handleSubmit = (e) => { e.preventDefault(); if (!item.name || !item.sku) return alert('SKU and Name are required.'); onSave({...item, qty: Number(item.qty), price: parseFloat(item.price), reorderLevel: Number(item.reorderLevel)}); };
            return (<form onSubmit={handleSubmit} className="space-y-4"><h2 className="text-2xl font-bold text-gray-800">{currentItem ? 'Edit Item' : 'Add New Item'}</h2><div><label className="block text-sm font-medium">SKU</label><input type="text" name="sku" value={item.sku} onChange={handleChange} required disabled={!currentItem} className="w-full px-3 py-2 border rounded-lg disabled:bg-gray-100" /></div><div><label className="block text-sm font-medium">Item Name</label><input type="text" name="name" value={item.name} onChange={handleChange} required className="w-full px-3 py-2 border rounded-lg" /></div><div className="grid grid-cols-2 gap-4"><div><label className="block text-sm font-medium">Brand</label><input type="text" name="brand" value={item.brand} onChange={handleChange} className="w-full px-3 py-2 border rounded-lg" /></div><div><label className="block text-sm font-medium">Location</label><input type="text" name="location" value={item.location} onChange={handleChange} className="w-full px-3 py-2 border rounded-lg" /></div></div><div className="grid grid-cols-2 gap-4"><div><label className="block text-sm font-medium">Price</label><input type="number" step="0.01" name="price" value={item.price} onChange={handleChange} required className="w-full px-3 py-2 border rounded-lg" /></div><div><label className="block text-sm font-medium">Reorder Level</label><input type="number" name="reorderLevel" value={item.reorderLevel} onChange={handleChange} required className="w-full px-3 py-2 border rounded-lg" /></div></div><div><label className="block text-sm font-medium">Initial Quantity</label><input type="number" name="qty" value={item.qty} onChange={handleChange} required disabled={!!currentItem} className="w-full px-3 py-2 border rounded-lg disabled:bg-gray-100" /></div><div className="flex justify-end gap-4 pt-4"><button type="button" onClick={onClose} className="px-6 py-2 bg-gray-100 rounded-full">Cancel</button><button type="submit" className="px-6 py-2 text-white bg-indigo-600 rounded-full">{currentItem ? 'Save' : 'Add'}</button></div></form>);
        };
        const SiteManagementForm = ({ sites, onClose }) => {
            const [newSite, setNewSite] = useState({ name: '', drPrefix: ''});
            const handleAddSite = async (e) => {
                e.preventDefault();
                if (!newSite.name || !newSite.drPrefix) return alert("Site Name and DR Prefix are required.");
                await db.collection(`artifacts/${appId}/public/data/sites`).add({ ...newSite, lastDrNumber: 0 });
                setNewSite({ name: '', drPrefix: ''});
            };
            return (<div className="space-y-6"><h2 className="text-2xl font-bold text-gray-800">Manage Sites</h2><form onSubmit={handleAddSite} className="flex gap-2 items-end"><div className="flex-grow"><label className="text-sm font-medium">Site Name</label><input type="text" value={newSite.name} onChange={e => setNewSite({...newSite, name: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div><div className="flex-grow"><label className="text-sm font-medium">DR Prefix (e.g., MNL)</label><input type="text" value={newSite.drPrefix} onChange={e => setNewSite({...newSite, drPrefix: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div><button type="submit" className="px-4 py-2 text-white bg-indigo-600 rounded-lg">Add</button></form><div className="border-t pt-4"><h3 className="font-bold mb-2">Existing Sites</h3><ul className="space-y-2">{sites.map(s => <li key={s.id} className="p-2 bg-gray-50 rounded-lg">{s.name} ({s.drPrefix})</li>)}</ul></div><div className="flex justify-end"><button onClick={onClose} className="px-6 py-2 bg-gray-200 rounded-full mt-4">Done</button></div></div>);
        };
        const AdjustStockForm = ({ item, onAdjust, onClose }) => {
            const [adjustment, setAdjustment] = useState(0);
            return (<div className="text-center"><h2 className="text-2xl font-bold text-gray-800 mb-2">Adjust Stock</h2><p className="mb-1 text-gray-600">{item.name}</p><p className="mb-4 text-sm font-mono text-gray-400">{item.sku}</p><div className="flex justify-center items-center gap-4 my-4"><button onClick={() => setAdjustment(adj => adj - 1)} className="font-bold text-2xl w-12 h-12 rounded-full bg-gray-200">-</button><input type="number" value={adjustment} onChange={e => setAdjustment(Number(e.target.value))} className="w-24 text-center text-2xl font-bold border-gray-300 rounded-lg" /><button onClick={() => setAdjustment(adj => adj + 1)} className="font-bold text-2xl w-12 h-12 rounded-full bg-gray-200">+</button></div><p className="text-sm mb-4">New Quantity: {Number(item.qty) + adjustment}</p><div className="flex justify-end gap-4 pt-4"><button type="button" onClick={onClose}>Cancel</button><button onClick={() => onAdjust(item, adjustment)} className="px-6 py-2 text-white bg-indigo-600 rounded-full">Apply</button></div></div>)
        };
        const SettingsForm = ({ currentSettings, onClose }) => {
            const [settings, setSettings] = useState(currentSettings);
            const [template, setTemplate] = useState({ name: '', address: '', contact: '', logo: null });

            useEffect(() => {
                const fetchTemplate = async () => {
                    const docRef = db.doc(`artifacts/${appId}/public/data/settings/receiptTemplate`);
                    const docSnap = await docRef.get();
                    if (docSnap.exists) {
                        setTemplate(docSnap.data());
                    }
                };
                fetchTemplate();
            }, []);

            const handleGeneralChange = e => setSettings(s => ({ ...s, [e.target.name]: e.target.value }));
            const handleTemplateChange = e => setTemplate(t => ({...t, [e.target.name]: e.target.value }));
            const handleLogoChange = (e) => {
                if (e.target.files?.[0]) {
                    const reader = new FileReader();
                    reader.onload = (ev) => setTemplate(p => ({...p, logo: ev.target.result}));
                    reader.readAsDataURL(e.target.files[0]);
                }
            };
            
            const handleSave = async () => {
                await db.collection(`artifacts/${appId}/public/data/settings`).doc('general').set({ ...settings }, { merge: true });
                await db.collection(`artifacts/${appId}/public/data/settings`).doc('receiptTemplate').set(template, { merge: true });
                alert('Settings saved!');
                onClose();
            };

            return (<div className="space-y-6"><h2 className="text-2xl font-bold text-gray-800">Settings</h2>
                <div className="p-4 border rounded-lg"><h3 className="font-bold mb-2">General Settings</h3><div><label className="block text-sm font-medium mt-2">Admin Password</label><input type="password" name="adminPass" value={settings.adminPass} onChange={handleGeneralChange} className="w-full px-3 py-2 border rounded-lg" /></div></div>
                <div className="p-4 border rounded-lg space-y-2"><h3 className="font-bold mb-2">Receipt Template</h3><div><label className="block text-sm font-medium">Company Name</label><input type="text" name="name" value={template.name} onChange={handleTemplateChange} className="w-full px-3 py-2 border rounded-lg" /></div><div><label className="block text-sm font-medium">Company Address</label><input type="text" name="address" value={template.address} onChange={handleTemplateChange} className="w-full px-3 py-2 border rounded-lg" /></div><div><label className="block text-sm font-medium">Company Contact</label><input type="text" name="contact" value={template.contact} onChange={handleTemplateChange} className="w-full px-3 py-2 border rounded-lg" /></div><div><label className="block text-sm font-medium">Logo</label><input type="file" accept="image/*" onChange={handleLogoChange} className="w-full text-sm file:mr-4 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" /></div></div>
                <div className="flex justify-end gap-4 pt-4"><button type="button" onClick={onClose} className="px-6 py-2 bg-gray-100 rounded-full">Cancel</button><button onClick={handleSave} className="px-6 py-2 text-white bg-indigo-600 rounded-full">Save Settings</button></div>
            </div>);
        };
        const DeliveryReceiptForm = ({ allItems, sites, onComplete, currentUser }) => { /* ... full component code ... */ };
        const DRDisplay = ({ receiptData, onDone }) => { /* ... full component code ... */ };
        const DRHistory = ({ }) => { /* ... full component code ... */ };
        const AnalyticsDashboard = ({ inventory, receipts }) => { /* ... full component code ... */ };

        function App() {
            const [user, setUser] = useState(null);
            const [isAdminMode, setIsAdminMode] = useState(false);
            const [inventory, setInventory] = useState([]);
            const [sites, setSites] = useState([]);
            const [receipts, setReceipts] = useState([]);
            const [settings, setSettings] = useState({ adminPass: 'superadmin' });
            const [isLoading, setIsLoading] = useState(true);
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [modal, setModal] = useState(null);
            const [currentItem, setCurrentItem] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [itemToDelete, setItemToDelete] = useState(null);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (authUser) => {
                    if (authUser) {
                        setUser(authUser);
                    } else {
                        try {
                            await auth.signInAnonymously();
                        } catch (e) {
                            console.error("Anonymous sign-in failed", e);
                        }
                    }
                    setIsAuthReady(true);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!isAuthReady) return;
                
                const basePath = `artifacts/${appId}/public/data`;
                
                const unsubInv = db.collection(`${basePath}/inventory`).orderBy('name').onSnapshot(snap => setInventory(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubSites = db.collection(`${basePath}/sites`).orderBy('name').onSnapshot(snap => setSites(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubSettings = db.doc(`${basePath}/settings/general`).onSnapshot((d) => { if (d.exists) { setSettings(s => ({...s, ...d.data()})); } });
                const unsubReceipts = db.collection(`${basePath}/deliveryReceipts`).orderBy('createdAt', 'desc').onSnapshot(snap => setReceipts(snap.docs.map(d => ({id:d.id, ...d.data()}))));
                
                setIsLoading(false);
                return () => { unsubInv(); unsubSites(); unsubSettings(); unsubReceipts(); };
            }, [isAuthReady]);

            const handleSaveItem = async (item) => {
                const path = `artifacts/${appId}/public/data/inventory`;
                const itemToSave = { ...item, createdAt: currentItem?.id ? item.createdAt : firebase.firestore.FieldValue.serverTimestamp() };
                try {
                    if (currentItem?.id) { await db.collection(path).doc(currentItem.id).update(itemToSave); } 
                    else { await db.collection(path).add(itemToSave); }
                    await logAction(isAdminMode ? 'Admin' : 'User', currentItem?.id ? 'Item Updated' : 'Item Added', `${item.name} (${item.sku})`);
                    setModal(null); setCurrentItem(null);
                } catch (e) { console.error("Save error:", e); }
            };
            const confirmDeleteItem = (id) => setItemToDelete(id);
            const handleDeleteItem = async () => { /* ... */ };
            const handleAdjustStock = async (item, adjustment) => { /* ... */ };
            const handleAdminLogin = (password) => { /* ... */ };
            const openModal = (type, item = null) => { setCurrentItem(item); setModal(type); };
            const filteredInventory = inventory.filter(item => (item.name?.toLowerCase() || '').includes(searchTerm.toLowerCase()) || (item.brand?.toLowerCase() || '').includes(searchTerm.toLowerCase()) || (item.sku?.toLowerCase() || '').includes(searchTerm.toLowerCase()));
            
            if (!isAuthReady || !user || isLoading) return <Spinner />;

            return (
                <div className="bg-gray-50 min-h-screen font-sans text-gray-800">
                    <style>{`@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap'); body { font-family: 'Poppins', sans-serif; } @keyframes scale-in{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-scale-in{animation:scale-in .2s ease-out forwards}@media print{body *{visibility:hidden}.printable-area,.printable-area *{visibility:visible}.printable-area{position:absolute;left:0;top:0;width:100%}.no-print{display:none}}`}</style>
                    <div className="container mx-auto p-4 sm:p-6 lg:p-8">
                        <header className="flex flex-wrap justify-between items-center gap-4 mb-8">
                            <div><h1 className="text-4xl font-bold text-gray-900">Warehouse Management</h1><p className="text-gray-500 mt-1">Logged in as: <span className={isAdminMode ? "font-bold text-indigo-600" : ""}>{isAdminMode ? "Administrator" : "User"}</span></p></div>
                            <div className="flex items-center gap-2 flex-wrap">
                                 <button onClick={() => openModal('admin_login')} className="bg-white text-gray-700 font-semibold p-2 rounded-full hover:bg-gray-100 shadow-sm border" title="Admin Access">üõ°Ô∏è</button>
                                 {isAdminMode && <button onClick={() => openModal('sites')} className="bg-white text-gray-700 font-semibold py-2 px-4 rounded-full hover:bg-gray-100 shadow-sm border">Manage Sites</button>}
                                 {isAdminMode && <button onClick={() => openModal('settings')} className="bg-white text-gray-700 font-semibold py-2 px-4 rounded-full hover:bg-gray-100 shadow-sm border">‚öôÔ∏è Settings</button>}
                                 <button onClick={() => openModal('reports')} className="bg-white text-gray-700 font-semibold py-2 px-4 rounded-full hover:bg-gray-100 shadow-sm border">üìä Reports</button>
                                 <button onClick={() => openModal('dr_history')} className="bg-white text-gray-700 font-semibold py-2 px-4 rounded-full hover:bg-gray-100 shadow-sm border">View Receipts</button>
                                 <button onClick={() => openModal('receipt')} className="bg-teal-500 text-white font-semibold py-2 px-4 rounded-full hover:bg-teal-600 shadow-md">üßæ Create Receipt</button>
                                 {isAdminMode && <button onClick={() => openModal('item')} className="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-full hover:bg-indigo-700 shadow-md">‚ûï Add Item</button>}
                            </div>
                        </header>
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div className="lg:col-span-3"><StatsWidget inventory={filteredInventory} /></div>
                            <LogsWidget isLoading={isLoading} />
                            <AllInventoryWidget inventory={filteredInventory} onEdit={(item) => openModal('item', item)} onDelete={confirmDeleteItem} onAdjustStock={(item) => openModal('stock', item)} isLoading={isLoading} searchTerm={searchTerm} setSearchTerm={setSearchTerm} isAdminMode={isAdminMode} settings={settings} />
                        </div>
                    </div>
                     {modal === 'item' && <Modal onClose={() => setModal(null)} size="lg"><ItemForm currentItem={currentItem} onSave={handleSaveItem} onClose={() => setModal(null)} /></Modal>}
                     {modal === 'stock' && <Modal onClose={() => setModal(null)} size="sm"><AdjustStockForm item={currentItem} onAdjust={handleAdjustStock} onClose={() => setModal(null)} /></Modal>}
                     {modal === 'receipt' && <Modal onClose={() => setModal(null)} size="5xl"><DeliveryReceiptForm allItems={inventory} sites={sites} onComplete={() => setModal(null)} currentUser={isAdminMode ? 'Admin' : 'User'} /></Modal>}
                     {modal === 'dr_history' && <Modal onClose={() => setModal(null)} size="5xl"><DRHistory /></Modal>}
                     {modal === 'reports' && <Modal onClose={() => setModal(null)} size="7xl"><AnalyticsDashboard inventory={inventory} receipts={receipts} /></Modal>}
                     {isAdminMode && modal === 'sites' && <Modal onClose={() => setModal(null)} size="lg"><SiteManagementForm sites={sites} onClose={() => setModal(null)} /></Modal>}
                     {isAdminMode && modal === 'settings' && <Modal onClose={() => setModal(null)} size="lg"><SettingsForm currentSettings={settings} onClose={() => setModal(null)} /></Modal>}
                     {modal === 'admin_login' && <Modal onClose={() => setModal(null)} size="sm"><AdminLoginModal onLogin={handleAdminLogin} /></Modal>}
                     <ConfirmationModal isOpen={!!itemToDelete} onClose={() => setItemToDelete(null)} onConfirm={handleDeleteItem} message="Are you sure? This cannot be undone." />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
