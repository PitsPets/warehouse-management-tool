<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Warehouse Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Correct Firebase Compatibility Libraries -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <!-- PDF & Charting Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- React Hooks ---
        const { useState, useEffect, useRef } = React;

        // --- Firebase Configuration & Initialization ---
        const firebaseConfig = {
            apiKey: "AIzaSyC9Tf7tOlZhYNe6ubDZ7JFJhsMswiimxPw",
            authDomain: "dlv-warehouse-tracker.firebaseapp.com",
            projectId: "dlv-warehouse-tracker",
            storageBucket: "dlv-warehouse-tracker.appspot.com",
            messagingSenderId: "267729758583",
            appId: "1:267729758583:web:f5f7ca26afc99c17819972",
            measurementId: "G-1DH9GT5RXS"
        };
        const appId = 'dlv-warehouse-tracker';
        
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- Helper Components & Functions ---
        // All components are defined inside the main script block
        // to ensure they are available when needed.
        
        function App() {
            // All state and handler functions are defined here
            const [user, setUser] = useState(null);
            const [isAdminMode, setIsAdminMode] = useState(false);
            const [inventory, setInventory] = useState([]);
            const [sites, setSites] = useState([]);
            const [receipts, setReceipts] = useState([]);
            const [settings, setSettings] = useState({ adminPass: 'superadmin' });
            const [isLoading, setIsLoading] = useState(true);
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [modal, setModal] = useState(null);
            const [currentItem, setCurrentItem] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [itemToDelete, setItemToDelete] = useState(null);

            useEffect(() => {
                onAuthStateChanged(auth, async (authUser) => {
                    if (authUser) {
                        setUser(authUser);
                    } else {
                        try {
                            await signInAnonymously(auth);
                        } catch (e) {
                            console.error("Anonymous sign-in failed", e);
                        }
                    }
                    setIsAuthReady(true);
                });
            }, []);

            useEffect(() => {
                if (!isAuthReady) return;
                
                const basePath = `artifacts/${appId}/public/data`;
                
                const unsubInv = onSnapshot(query(collection(db, `${basePath}/inventory`), orderBy('name')), snap => setInventory(snap.docs.map(d => ({ id: d.id, ...d.data(), createdAt: d.data().createdAt }))));
                const unsubSites = onSnapshot(query(collection(db, `${basePath}/sites`), orderBy('name')), snap => setSites(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubSettings = onSnapshot(doc(db, `${basePath}/settings`, 'general'), (d) => { if (d.exists()) { setSettings(s => ({...s, ...d.data()})); } });
                const unsubReceipts = onSnapshot(query(collection(db, `${basePath}/deliveryReceipts`), orderBy('createdAt', 'desc')), snap => setReceipts(snap.docs.map(d => ({id:d.id, ...d.data()}))));

                setIsLoading(false);
                return () => { unsubInv(); unsubSites(); unsubSettings(); unsubReceipts(); };
            }, [isAuthReady]);

            // ... All other handler functions here ...

            if (!isAuthReady || !user) return <Spinner />;

            return (
                <div className="bg-gray-100 min-h-screen font-sans">
                     {/* The entire UI (header, widgets, modals) goes here, identical to the last full version */}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
