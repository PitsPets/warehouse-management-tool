<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Warehouse Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-100 min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        const DEFAULT_UNITS = ['PC/s', 'Roll/s', 'Meter/s', 'Box', 'Length', 'Assy', 'Set/s'];

        const SAMPLE_INVENTORY = [
            { sku: 'SKU-1001', name: 'Electrical Cable', price: 125, stock: 48, units: ['Meter/s', 'Roll/s'] },
            { sku: 'SKU-1002', name: 'Welding Rod', price: 88, stock: 120, units: ['Box', 'Set/s'] },
            { sku: 'SKU-1003', name: 'Steel Plate', price: 230, stock: 35, units: ['Length', 'Set/s'] },
            { sku: 'SKU-1004', name: 'Protective Gloves', price: 45, stock: 210, units: ['PC/s', 'Set/s'] }
        ];

        const STORAGE_KEY = 'wm_receipts_v1';

        const formatCurrency = (value) => new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP' }).format(value || 0);

        const formatUnitDisplay = (quantity, unit) => {
            if (!unit) return '';
            const qty = Number(quantity) || 0;
            if (qty === 1) {
                return unit.replace(/\/s$/i, '').replace(/s$/i, '');
            }
            if (/s$/i.test(unit)) return unit;
            return unit + 's';
        };

        const Modal = ({ title, onClose, children, actions, size = 'xl' }) => (
            <div className="fixed inset-0 z-50 flex items-center justify-center">
                <div className="absolute inset-0 bg-slate-900/40" onClick={onClose}></div>
                <div className={`relative bg-white shadow-xl rounded-xl w-full max-h-[90vh] overflow-hidden ${size === '2xl' ? 'max-w-5xl' : size === 'lg' ? 'max-w-3xl' : 'max-w-6xl'}`}>
                    <div className="flex items-start justify-between px-6 py-4 border-b border-slate-200">
                        <div>
                            <h2 className="text-lg font-semibold text-slate-800">{title}</h2>
                            <p className="text-sm text-slate-500">Warehouse Management Tool</p>
                        </div>
                        <button onClick={onClose} className="text-slate-400 hover:text-slate-600">
                            <span className="sr-only">Close</span>
                            &times;
                        </button>
                    </div>
                    <div className="overflow-y-auto max-h-[70vh] px-6 py-4 bg-slate-50">{children}</div>
                    {actions && (
                        <div className="px-6 py-4 bg-white border-t border-slate-200 flex justify-end space-x-3">
                            {actions}
                        </div>
                    )}
                </div>
            </div>
        );

        const InventoryTable = ({ items, onAdd }) => {
            const [filters, setFilters] = useState({ search: '' });
            const filtered = useMemo(() => {
                const term = filters.search.trim().toLowerCase();
                if (!term) return items;
                return items.filter(item => [item.sku, item.name].some(v => v.toLowerCase().includes(term)));
            }, [items, filters.search]);

            return (
                <div className="space-y-3">
                    <div className="flex items-center justify-between">
                        <h3 className="text-base font-semibold text-slate-700">Inventory</h3>
                        <input
                            type="search"
                            value={filters.search}
                            onChange={(e) => setFilters({ ...filters, search: e.target.value })}
                            placeholder="Search SKU or Name"
                            className="rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                    </div>
                    <div className="overflow-x-auto rounded-lg border border-slate-200 bg-white">
                        <table className="min-w-full divide-y divide-slate-200 text-sm">
                            <thead className="bg-slate-100">
                                <tr>
                                    <th className="px-3 py-2 text-left font-medium text-slate-600">SKU</th>
                                    <th className="px-3 py-2 text-left font-medium text-slate-600">Name</th>
                                    <th className="px-3 py-2 text-right font-medium text-slate-600">Stock</th>
                                    <th className="px-3 py-2 text-right font-medium text-slate-600">Unit Price</th>
                                    <th className="px-3 py-2 text-right font-medium text-slate-600">Add</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-200">
                                {filtered.length === 0 && (
                                    <tr>
                                        <td colSpan="5" className="px-3 py-6 text-center text-slate-400">No items found.</td>
                                    </tr>
                                )}
                                {filtered.map(item => (
                                    <InventoryRow key={item.sku} item={item} onAdd={onAdd} />
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const InventoryRow = ({ item, onAdd }) => {
            const [quantity, setQuantity] = useState(1);
            const [unit, setUnit] = useState(item.units?.[0] || 'PC/s');

            const handleAdd = () => {
                if (quantity <= 0) return;
                onAdd({
                    sku: item.sku,
                    description: item.name,
                    price: item.price,
                    quantity,
                    unit,
                    amount: Number(quantity) * Number(item.price)
                });
                setQuantity(1);
            };

            return (
                <tr>
                    <td className="px-3 py-2 align-top">
                        <div className="font-semibold text-slate-700">{item.sku}</div>
                        <div className="text-xs text-slate-500">{item.units?.join(', ') || 'PC/s'}</div>
                    </td>
                    <td className="px-3 py-2 text-slate-600">{item.name}</td>
                    <td className="px-3 py-2 text-right text-slate-600">{item.stock}</td>
                    <td className="px-3 py-2 text-right text-slate-600">{formatCurrency(item.price)}</td>
                    <td className="px-3 py-2">
                        <div className="flex items-center justify-end space-x-2">
                            <input
                                type="number"
                                min="1"
                                value={quantity}
                                onChange={(e) => setQuantity(Number(e.target.value))}
                                className="w-20 rounded border border-slate-300 px-2 py-1 text-right text-sm"
                            />
                            <select
                                value={unit}
                                onChange={(e) => setUnit(e.target.value)}
                                className="rounded border border-slate-300 px-2 py-1 text-sm"
                            >
                                {(item.units?.length ? item.units : DEFAULT_UNITS).map(option => (
                                    <option key={option} value={option}>{option}</option>
                                ))}
                            </select>
                            <button
                                onClick={handleAdd}
                                className="rounded bg-blue-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-blue-700"
                            >
                                Add
                            </button>
                        </div>
                    </td>
                </tr>
            );
        };

        const ReceiptPreview = ({ items, meta }) => {
            const total = items.reduce((sum, item) => sum + (Number(item.amount) || 0), 0);
            return (
                <div className="bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden">
                    <div className="px-4 py-3 border-b border-slate-200 bg-slate-100">
                        <h4 className="text-base font-semibold text-slate-700">Delivery Receipt Preview</h4>
                        <p className="text-xs text-slate-500">{meta.reference || 'Draft'} &bull; {meta.site || 'Main Warehouse'}</p>
                    </div>
                    <div className="px-4 py-3">
                        <div className="overflow-x-auto">
                            <table className="min-w-full text-sm">
                                <thead className="bg-slate-100">
                                    <tr className="text-left text-slate-600">
                                        <th className="px-3 py-2 w-16">Qty</th>
                                        <th className="px-3 py-2 w-24">Unit</th>
                                        <th className="px-3 py-2">Description</th>
                                        <th className="px-3 py-2 w-32 text-right">Unit Price</th>
                                        <th className="px-3 py-2 w-32 text-right">Amount</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-200">
                                    {items.length === 0 && (
                                        <tr>
                                            <td colSpan="5" className="px-3 py-6 text-center text-slate-400">No items yet.</td>
                                        </tr>
                                    )}
                                    {items.map((item, idx) => (
                                        <tr key={idx} className="text-slate-700">
                                            <td className="px-3 py-2">{item.quantity}</td>
                                            <td className="px-3 py-2">{formatUnitDisplay(item.quantity, item.unit)}</td>
                                            <td className="px-3 py-2 break-words">{item.description}</td>
                                            <td className="px-3 py-2 text-right">{formatCurrency(item.price)}</td>
                                            <td className="px-3 py-2 text-right">{formatCurrency(item.amount)}</td>
                                        </tr>
                                    ))}
                                </tbody>
                                <tfoot className="bg-slate-50">
                                    <tr>
                                        <td colSpan="4" className="px-3 py-2 text-right font-semibold text-slate-600">Grand Total</td>
                                        <td className="px-3 py-2 text-right font-semibold text-slate-700">{formatCurrency(total)}</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        const CartTable = ({ items, onUpdate, onRemove }) => (
            <div className="overflow-x-auto rounded-lg border border-slate-200 bg-white">
                <table className="min-w-full divide-y divide-slate-200 text-sm">
                    <thead className="bg-slate-100 text-slate-600">
                        <tr>
                            <th className="px-3 py-2 text-left">Description</th>
                            <th className="px-3 py-2 text-right w-24">Qty</th>
                            <th className="px-3 py-2 w-28">Unit</th>
                            <th className="px-3 py-2 text-right w-32">Unit Price</th>
                            <th className="px-3 py-2 text-right w-32">Amount</th>
                            <th className="px-3 py-2 w-16"></th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-200 text-slate-700">
                        {items.length === 0 && (
                            <tr>
                                <td colSpan="6" className="px-3 py-6 text-center text-slate-400">No items added.</td>
                            </tr>
                        )}
                        {items.map((item, idx) => (
                            <tr key={idx}>
                                <td className="px-3 py-2">
                                    <div className="font-medium">{item.description}</div>
                                    {item.sku && <div className="text-xs text-slate-400">{item.sku}</div>}
                                </td>
                                <td className="px-3 py-2 text-right">
                                    <input
                                        type="number"
                                        min="1"
                                        value={item.quantity}
                                        onChange={(e) => onUpdate(idx, { quantity: Number(e.target.value) })}
                                        className="w-20 rounded border border-slate-300 px-2 py-1 text-right text-sm"
                                    />
                                </td>
                                <td className="px-3 py-2">
                                    <select
                                        value={item.unit}
                                        onChange={(e) => onUpdate(idx, { unit: e.target.value })}
                                        className="w-full rounded border border-slate-300 px-2 py-1 text-sm"
                                    >
                                        {DEFAULT_UNITS.map(option => (
                                            <option key={option} value={option}>{option}</option>
                                        ))}
                                    </select>
                                </td>
                                <td className="px-3 py-2 text-right">
                                    <input
                                        type="number"
                                        min="0"
                                        value={item.price}
                                        onChange={(e) => onUpdate(idx, { price: Number(e.target.value) })}
                                        className="w-24 rounded border border-slate-300 px-2 py-1 text-right text-sm"
                                    />
                                </td>
                                <td className="px-3 py-2 text-right">{formatCurrency(item.amount)}</td>
                                <td className="px-3 py-2 text-right">
                                    <button
                                        onClick={() => onRemove(idx)}
                                        className="text-sm text-rose-500 hover:text-rose-600"
                                    >
                                        Remove
                                    </button>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        );

        const InventoryReceiptModal = ({ onClose, onSave }) => {
            const [cart, setCart] = useState([]);
            const [site, setSite] = useState('Main Warehouse');
            const [reference, setReference] = useState('DR-' + Date.now());

            const handleAdd = (item) => {
                setCart(prev => {
                    const index = prev.findIndex(entry => entry.description === item.description && entry.unit === item.unit);
                    if (index !== -1) {
                        const updated = [...prev];
                        const existing = updated[index];
                        const quantity = Number(existing.quantity) + Number(item.quantity);
                        updated[index] = {
                            ...existing,
                            quantity,
                            amount: quantity * existing.price
                        };
                        return updated;
                    }
                    return [...prev, { ...item }];
                });
            };

            const updateCart = (index, changes) => {
                setCart(prev => {
                    const updated = [...prev];
                    const current = { ...updated[index], ...changes };
                    current.amount = Number(current.quantity || 0) * Number(current.price || 0);
                    updated[index] = current;
                    return updated;
                });
            };

            const removeItem = (index) => setCart(prev => prev.filter((_, idx) => idx !== index));

            const handleSave = () => {
                if (cart.length === 0) {
                    alert('Please add at least one item.');
                    return;
                }
                onSave({
                    id: crypto.randomUUID(),
                    number: reference,
                    createdAt: new Date().toISOString(),
                    type: 'Inventory',
                    site,
                    items: cart,
                    total: cart.reduce((sum, item) => sum + (Number(item.amount) || 0), 0)
                });
                onClose();
            };

            return (
                <Modal
                    title="Create Delivery Receipt"
                    onClose={onClose}
                    actions={[
                        <button key="cancel" onClick={onClose} className="rounded border border-slate-300 px-4 py-2 text-sm text-slate-600">Cancel</button>,
                        <button key="save" onClick={handleSave} className="rounded bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700">Save Receipt</button>
                    ]}
                >
                    <div className="grid gap-6 lg:grid-cols-2">
                        <div className="space-y-6">
                            <div className="grid gap-3 rounded-lg border border-slate-200 bg-white p-4">
                                <label className="text-sm font-medium text-slate-600">
                                    Receipt Number
                                    <input
                                        className="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-sm"
                                        value={reference}
                                        onChange={(e) => setReference(e.target.value)}
                                    />
                                </label>
                                <label className="text-sm font-medium text-slate-600">
                                    Site / Project
                                    <input
                                        className="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-sm"
                                        value={site}
                                        onChange={(e) => setSite(e.target.value)}
                                    />
                                </label>
                            </div>
                            <InventoryTable items={SAMPLE_INVENTORY} onAdd={handleAdd} />
                        </div>
                        <div className="space-y-4">
                            <h3 className="text-base font-semibold text-slate-700">Items Added</h3>
                            <CartTable items={cart} onUpdate={updateCart} onRemove={removeItem} />
                            <ReceiptPreview items={cart} meta={{ site, reference }} />
                        </div>
                    </div>
                </Modal>
            );
        };

        const ManualReceiptModal = ({ onClose, onSave }) => {
            const [rows, setRows] = useState([
                { description: '', quantity: 1, unit: 'PC/s', price: 0, amount: 0 }
            ]);
            const [site, setSite] = useState('Main Warehouse');
            const [reference, setReference] = useState('MAN-' + Date.now());

            const updateRow = (index, changes) => {
                setRows(prev => {
                    const updated = [...prev];
                    const current = { ...updated[index], ...changes };
                    current.amount = Number(current.quantity || 0) * Number(current.price || 0);
                    updated[index] = current;
                    return updated;
                });
            };

            const addRow = () => setRows(prev => [...prev, { description: '', quantity: 1, unit: 'PC/s', price: 0, amount: 0 }]);
            const removeRow = (index) => setRows(prev => prev.filter((_, idx) => idx !== index));

            const handleSave = () => {
                const cleaned = rows
                    .map(row => ({
                        ...row,
                        description: row.description.trim(),
                        amount: Number(row.quantity || 0) * Number(row.price || 0)
                    }))
                    .filter(row => row.description && Number(row.quantity) > 0);

                if (cleaned.length === 0) {
                    alert('Please provide at least one complete row.');
                    return;
                }

                onSave({
                    id: crypto.randomUUID(),
                    number: reference,
                    createdAt: new Date().toISOString(),
                    type: 'Manual',
                    site,
                    items: cleaned,
                    total: cleaned.reduce((sum, item) => sum + (Number(item.amount) || 0), 0)
                });
                onClose();
            };

            return (
                <Modal
                    title="Manual Delivery Receipt"
                    onClose={onClose}
                    actions={[
                        <button key="cancel" onClick={onClose} className="rounded border border-slate-300 px-4 py-2 text-sm text-slate-600">Cancel</button>,
                        <button key="save" onClick={handleSave} className="rounded bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700">Save Receipt</button>
                    ]}
                >
                    <div className="space-y-6">
                        <div className="grid gap-3 rounded-lg border border-slate-200 bg-white p-4 lg:grid-cols-2">
                            <label className="text-sm font-medium text-slate-600">
                                Receipt Number
                                <input
                                    className="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-sm"
                                    value={reference}
                                    onChange={(e) => setReference(e.target.value)}
                                />
                            </label>
                            <label className="text-sm font-medium text-slate-600">
                                Site / Project
                                <input
                                    className="mt-1 w-full rounded border border-slate-300 px-3 py-2 text-sm"
                                    value={site}
                                    onChange={(e) => setSite(e.target.value)}
                                />
                            </label>
                        </div>
                        <div className="space-y-4">
                            <div className="overflow-x-auto rounded-lg border border-slate-200 bg-white">
                                <table className="min-w-full divide-y divide-slate-200 text-sm">
                                    <thead className="bg-slate-100 text-slate-600">
                                        <tr>
                                            <th className="px-3 py-2 w-20 text-left">Qty</th>
                                            <th className="px-3 py-2 w-24 text-left">Unit</th>
                                            <th className="px-3 py-2 text-left">Description</th>
                                            <th className="px-3 py-2 w-28 text-right">Unit Price</th>
                                            <th className="px-3 py-2 w-20"></th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-200 text-slate-700">
                                        {rows.map((row, idx) => (
                                            <tr key={idx}>
                                                <td className="px-3 py-2">
                                                    <input
                                                        type="number"
                                                        min="1"
                                                        value={row.quantity}
                                                        onChange={(e) => updateRow(idx, { quantity: Number(e.target.value) })}
                                                        className="w-full rounded border border-slate-300 px-2 py-1 text-sm"
                                                    />
                                                </td>
                                                <td className="px-3 py-2">
                                                    <select
                                                        value={row.unit}
                                                        onChange={(e) => updateRow(idx, { unit: e.target.value })}
                                                        className="w-full rounded border border-slate-300 px-2 py-1 text-sm"
                                                    >
                                                        {DEFAULT_UNITS.map(option => (
                                                            <option key={option} value={option}>{option}</option>
                                                        ))}
                                                    </select>
                                                </td>
                                                <td className="px-3 py-2">
                                                    <textarea
                                                        value={row.description}
                                                        onChange={(e) => updateRow(idx, { description: e.target.value })}
                                                        rows="2"
                                                        className="w-full rounded border border-slate-300 px-2 py-1 text-sm"
                                                        placeholder="Item description"
                                                    ></textarea>
                                                </td>
                                                <td className="px-3 py-2 text-right">
                                                    <input
                                                        type="number"
                                                        min="0"
                                                        value={row.price}
                                                        onChange={(e) => updateRow(idx, { price: Number(e.target.value) })}
                                                        className="w-full rounded border border-slate-300 px-2 py-1 text-sm text-right"
                                                    />
                                                </td>
                                                <td className="px-3 py-2 text-right">
                                                    <button onClick={() => removeRow(idx)} className="text-sm text-rose-500 hover:text-rose-600">Remove</button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <button
                                onClick={addRow}
                                className="rounded border border-dashed border-blue-400 px-4 py-2 text-sm font-medium text-blue-600 hover:border-blue-500 hover:text-blue-700"
                            >
                                Add Row
                            </button>
                            <ReceiptPreview items={rows} meta={{ reference, site }} />
                        </div>
                    </div>
                </Modal>
            );
        };

        const ReportsModal = ({ onClose, receipts }) => {
            const [range, setRange] = useState('30');

            const filtered = useMemo(() => {
                const days = Number(range);
                if (!days) return receipts;
                const threshold = Date.now() - days * 24 * 60 * 60 * 1000;
                return receipts.filter(receipt => new Date(receipt.createdAt).getTime() >= threshold);
            }, [receipts, range]);

            const totals = useMemo(() => {
                const totalAmount = filtered.reduce((sum, receipt) => sum + (receipt.total || 0), 0);
                const totalReceipts = filtered.length;
                const itemUsage = new Map();
                filtered.forEach(receipt => {
                    receipt.items.forEach(item => {
                        const key = item.description || item.sku || 'Unknown Item';
                        const current = itemUsage.get(key) || { quantity: 0, amount: 0 };
                        current.quantity += Number(item.quantity) || 0;
                        current.amount += Number(item.amount) || 0;
                        itemUsage.set(key, current);
                    });
                });
                const topItems = Array.from(itemUsage.entries())
                    .map(([name, stats]) => ({ name, ...stats }))
                    .sort((a, b) => b.quantity - a.quantity)
                    .slice(0, 5);
                return { totalAmount, totalReceipts, topItems };
            }, [filtered]);

            return (
                <Modal
                    title="Reports & Usage Analytics"
                    onClose={onClose}
                    actions={[
                        <button key="close" onClick={onClose} className="rounded bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700">Close</button>
                    ]}
                    size="2xl"
                >
                    <div className="space-y-6">
                        <div className="flex flex-wrap items-center justify-between gap-3">
                            <div>
                                <h3 className="text-base font-semibold text-slate-700">Overview</h3>
                                <p className="text-sm text-slate-500">Showing receipts from the last {range} days.</p>
                            </div>
                            <select
                                value={range}
                                onChange={(e) => setRange(e.target.value)}
                                className="rounded border border-slate-300 px-3 py-2 text-sm"
                            >
                                <option value="7">Last 7 days</option>
                                <option value="30">Last 30 days</option>
                                <option value="90">Last 90 days</option>
                                <option value="0">All time</option>
                            </select>
                        </div>
                        <div className="grid gap-4 sm:grid-cols-3">
                            <StatCard label="Receipts" value={totals.totalReceipts} />
                            <StatCard label="Total Amount" value={formatCurrency(totals.totalAmount)} />
                            <StatCard label="Average" value={totals.totalReceipts ? formatCurrency(totals.totalAmount / totals.totalReceipts) : formatCurrency(0)} />
                        </div>
                        <div className="space-y-3">
                            <h4 className="text-sm font-semibold text-slate-700">Top Used Items</h4>
                            <div className="overflow-hidden rounded-lg border border-slate-200 bg-white">
                                <table className="min-w-full divide-y divide-slate-200 text-sm">
                                    <thead className="bg-slate-100 text-slate-600">
                                        <tr>
                                            <th className="px-3 py-2 text-left">Item</th>
                                            <th className="px-3 py-2 text-right w-32">Quantity</th>
                                            <th className="px-3 py-2 text-right w-32">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-200 text-slate-700">
                                        {totals.topItems.length === 0 && (
                                            <tr>
                                                <td colSpan="3" className="px-3 py-6 text-center text-slate-400">No usage data yet.</td>
                                            </tr>
                                        )}
                                        {totals.topItems.map(item => (
                                            <tr key={item.name}>
                                                <td className="px-3 py-2">{item.name}</td>
                                                <td className="px-3 py-2 text-right">{item.quantity}</td>
                                                <td className="px-3 py-2 text-right">{formatCurrency(item.amount)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </Modal>
            );
        };

        const StatCard = ({ label, value }) => (
            <div className="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
                <p className="text-xs uppercase tracking-wide text-slate-500">{label}</p>
                <p className="mt-2 text-2xl font-semibold text-slate-800">{value}</p>
            </div>
        );

        const ReceiptManager = ({ receipts }) => {
            const [search, setSearch] = useState('');
            const filtered = useMemo(() => {
                const term = search.trim().toLowerCase();
                if (!term) return receipts;
                return receipts.filter(receipt => {
                    return [receipt.number, receipt.site, receipt.type, receipt.createdAt]
                        .filter(Boolean)
                        .some(value => value.toLowerCase().includes(term));
                });
            }, [receipts, search]);

            return (
                <div className="rounded-xl border border-slate-200 bg-white p-6 shadow-sm">
                    <div className="flex flex-wrap items-center justify-between gap-3">
                        <h2 className="text-lg font-semibold text-slate-800">Delivery Receipt Manager</h2>
                        <input
                            type="search"
                            value={search}
                            onChange={(e) => setSearch(e.target.value)}
                            placeholder="Search by number, site, or date"
                            className="rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                    </div>
                    <div className="mt-4 overflow-x-auto">
                        <table className="min-w-full divide-y divide-slate-200 text-sm">
                            <thead className="bg-slate-100 text-slate-600">
                                <tr>
                                    <th className="px-3 py-2 text-left">Number</th>
                                    <th className="px-3 py-2 text-left">Site</th>
                                    <th className="px-3 py-2 text-left">Type</th>
                                    <th className="px-3 py-2 text-left">Created</th>
                                    <th className="px-3 py-2 text-right">Total</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-200 text-slate-700">
                                {filtered.length === 0 && (
                                    <tr>
                                        <td colSpan="5" className="px-3 py-8 text-center text-slate-400">No receipts yet.</td>
                                    </tr>
                                )}
                                {filtered.map(receipt => (
                                    <tr key={receipt.id}>
                                        <td className="px-3 py-2 font-medium text-slate-800">{receipt.number}</td>
                                        <td className="px-3 py-2">{receipt.site}</td>
                                        <td className="px-3 py-2">{receipt.type}</td>
                                        <td className="px-3 py-2">{new Date(receipt.createdAt).toLocaleString()}</td>
                                        <td className="px-3 py-2 text-right font-semibold">{formatCurrency(receipt.total)}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [receipts, setReceipts] = useState(() => {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (!stored) return [];
                try {
                    return JSON.parse(stored);
                } catch (error) {
                    console.warn('Failed to parse stored receipts', error);
                    return [];
                }
            });
            const [modal, setModal] = useState(null);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(receipts));
            }, [receipts]);

            const handleSaveReceipt = (receipt) => {
                setReceipts(prev => [receipt, ...prev]);
            };

            return (
                <div className="max-w-6xl mx-auto px-4 py-10 space-y-8">
                    <header className="flex flex-col gap-4 rounded-2xl bg-gradient-to-br from-blue-600 to-indigo-600 p-6 text-white shadow-lg sm:flex-row sm:items-center sm:justify-between">
                        <div>
                            <h1 className="text-2xl font-semibold">Warehouse Management Tool</h1>
                            <p className="text-sm text-blue-100">Manage inventory deliveries and track manual receipts.</p>
                        </div>
                        <div className="flex flex-wrap gap-3">
                            <button
                                onClick={() => setModal('inventory')}
                                className="rounded-lg bg-white px-4 py-2 text-sm font-semibold text-blue-600 shadow-sm hover:bg-blue-50"
                            >
                                Create Delivery Receipt
                            </button>
                            <button
                                onClick={() => setModal('manual')}
                                className="rounded-lg bg-white/10 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-white/20"
                            >
                                Manual Receipt
                            </button>
                            <button
                                onClick={() => setModal('reports')}
                                className="rounded-lg bg-indigo-900/40 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-900/60"
                            >
                                Reports
                            </button>
                        </div>
                    </header>
                    <ReceiptManager receipts={receipts} />
                    {modal === 'inventory' && (
                        <InventoryReceiptModal onClose={() => setModal(null)} onSave={handleSaveReceipt} />
                    )}
                    {modal === 'manual' && (
                        <ManualReceiptModal onClose={() => setModal(null)} onSave={handleSaveReceipt} />
                    )}
                    {modal === 'reports' && (
                        <ReportsModal onClose={() => setModal(null)} receipts={receipts} />
                    )}
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
